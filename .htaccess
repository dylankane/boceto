# Enable rewrite engine
RewriteEngine On

# Always serve index.html for directory requests
DirectoryIndex index.html

# 0) Let real files pass straight through (but NOT directories)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# 1) Redirect /something.html -> /something  (only for user-typed URLs)
RewriteCond %{THE_REQUEST} \s/([^\s?]+)\.html[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# 2) Internally serve .html when extension omitted
#    /something -> /something.html  (no visible redirect)
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+)$ $1.html [L]

# 2a) Language roots: /en/ or /es/ -> their index.html
RewriteRule ^(en|es)/?$ $1/index.html [L]

# 3) Language detection (only if no /en/ or /es/ prefix yet)
RewriteCond %{REQUEST_URI} !^/(en|es)/ [NC]
RewriteCond %{REQUEST_URI} !^/\.well-known/ [NC]
# English browsers -> /en/...
RewriteCond %{HTTP:Accept-Language} ^en [NC]
RewriteRule ^(.*)$ /en/$1 [R=302,L]

# Default (Spanish) if still no prefix
RewriteCond %{REQUEST_URI} !^/(en|es)/ [NC]
RewriteRule ^(.*)$ /es/$1 [R=302,L]

# 4) Custom error page (URL path, not filesystem path)
ErrorDocument 404 /es/404.html
